# MP3タグ一括編集アプリ

複数のMP3ファイルのアーティスト名とアルバム名を一度に書き換えるRubyアプリケーションです。

## 機能

- 複数のMP3ファイルのアーティスト名とアルバム名を一括編集
- コマンドライン引数モードと対話型モードの両方をサポート
- サブディレクトリの再帰的検索に対応
- DRY RUNモードで変更内容を事前確認可能（コマンドライン引数モードと対話型モードの両方で利用可能）
- ファイル名からトラック番号とタイトルを自動抽出して更新（`--parse-file-name`オプション）
- ID3v2タグの読み取りに対応（Windowsエクスプローラで確認可能）
- ID3v1タグの書き込みに対応（アーティスト/アルバムを更新）

## 必要な環境

### ライブラリのインストール

本アプリは[id3tag](https://rubygems.org/gems/id3tag) gemに依存しています。

```bash
gem install id3tag
```

id3tagはID3v2/ID3v1タグの読み取りを担当し、書き込みは本アプリ内蔵のID3v1エディタが行います。

## インストール

```bash
# 実行権限を付与
chmod +x mp3_tag_editor.rb
```

## 使用方法

### 対話型モード

オプションを指定せずに実行すると、対話型モードで起動します：

```bash
ruby mp3_tag_editor.rb
```

対話型モードでは、以下の情報を順に入力します：
1. MP3ファイルが含まれるディレクトリ
2. サブディレクトリも検索するか
3. 新しいアーティスト名（変更しない場合はEnter）
4. 新しいアルバム名（変更しない場合はEnter）
5. ドライランモードで実行するか（y/n）
6. 実行確認

ドライランモードを選択すると、実際には変更せずに変更内容を確認できます。

### コマンドライン引数モード

```bash
ruby mp3_tag_editor.rb -d /path/to/mp3/files -a "アーティスト名" -l "アルバム名"
```

#### オプション

- `-d, --directory DIR`: MP3ファイルが含まれるディレクトリまたは単一のMP3ファイルを指定（複数回指定可能）。引数として直接ファイル/ディレクトリを並べることもできます
- `-a, --artist NAME`: アーティスト名を指定
- `-l, --album NAME`: アルバム名を指定
- `-r, --recursive`: サブディレクトリも再帰的に検索
- `-n, --dry-run`: 実際には変更せず、変更内容を表示するだけ
- `-v, --verbose`: 詳細な情報を表示
- `--parse-file-name`: ファイル名からトラック番号とタイトルを抽出して更新する（ファイル名の形式: `数字 タイトル.mp3` または `数字-タイトル.mp3` など）
- `-h, --help`: ヘルプを表示
- `--version`: バージョン情報を表示

## 使用例

### 例1: 基本的な使用（対話型）

```bash
ruby mp3_tag_editor.rb
```

### 例2: コマンドラインでアーティスト名とアルバム名を指定

```bash
ruby mp3_tag_editor.rb -d ~/Music/album1 -a "アーティスト名" -l "アルバム名"
```

### 例3: サブディレクトリも含めて検索

```bash
ruby mp3_tag_editor.rb -d ~/Music -r -a "アーティスト名" -l "アルバム名"
```

### 例4: DRY RUNモードで変更内容を確認

```bash
ruby mp3_tag_editor.rb -d ~/Music -a "アーティスト名" -l "アルバム名" -n
```

### 例5: アーティスト名のみ変更（アルバム名は変更しない）

```bash
ruby mp3_tag_editor.rb -d ~/Music -a "新しいアーティスト名"
```

### 例6: 詳細モードで実行

```bash
ruby mp3_tag_editor.rb -d ~/Music -a "アーティスト名" -l "アルバム名" -v
```

### 例7: ファイル名からトラック番号とタイトルを抽出して更新

```bash
ruby mp3_tag_editor.rb -d ~/Music -a "アーティスト名" -l "アルバム名" --parse-file-name
```

この例では、ファイル名が `01 曲名.mp3` や `01-曲名.mp3` のような形式（数字 + 区切り文字 + タイトル + .mp3）の場合、ファイル名からトラック番号とタイトルを自動抽出してタグに設定します。ファイル名がこのパターンに一致しない場合は、そのファイルは一切変更されません。

**注意**: 拡張子が重複しているファイル名（例: `01 A Song.mp3.mp3`）はパターンに一致しません。これは`lame`コマンドをファイル名引数1つで使用した場合などに作成される形式です。

## 注意事項

- **バックアップを取る**: 実行前にMP3ファイルのバックアップを取ることを強く推奨します
- **DRY RUNモード**: 初めて使用する場合は、`-n`オプション（コマンドライン引数モード）または対話型モードでドライランを選択して、変更内容を確認してください
- **ファイル形式**: MP3ファイル（.mp3）のみ対応しています
- **ID3タグのバージョン**: 
  - 読み取り: id3tagによりID3v2/ID3v1の両方に対応
  - 書き込み: アプリ内蔵のID3v1エディタでアーティスト/アルバムのみ更新（Windowsで即時反映されない場合は再読込が必要です）
- **`--parse-file-name`オプションについて**: 
  - ファイル名からトラック番号とタイトルを抽出する際、ファイル名は `数字 タイトル.mp3` または `数字-タイトル.mp3`、`数字_タイトル.mp3` の形式である必要があります（例: `01 曲名.mp3`、`01-曲名.mp3`）
  - **ファイル名がこのパターンに一致しない場合、そのファイルは一切変更されません**（アーティスト名やアルバム名が指定されていても変更されません）
  - 拡張子が重複しているファイル名（例: `01 A Song.mp3.mp3`）はパターンに一致しません。これは`lame`コマンドをファイル名引数1つで使用した場合などに作成される形式です
  - パターンに一致しないファイルはスキップされ、verboseモードまたはdry-runモードではスキップされたファイルが表示されます

## トラブルシューティング

### ライブラリが見つからないエラー

```
エラー: MP3タグ編集ライブラリがインストールされていません。
```

**解決方法**: 上記の「必要な環境」セクションを参照して、ライブラリをインストールしてください。

### ディレクトリが見つからないエラー

```
エラー: ディレクトリが見つかりません: /path/to/directory
```

**解決方法**: ディレクトリパスが正しいか確認してください。絶対パスまたは相対パスを使用できます。

### MP3ファイルが見つからないエラー

```
エラー: MP3ファイルが見つかりませんでした。
```

**解決方法**: 
- 指定したディレクトリにMP3ファイルが存在するか確認してください
- サブディレクトリにMP3ファイルがある場合は、`-r`オプションを使用してください

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。
